<html lang="en" xml:lang="en" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <title>Coding guidelines</title>
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" href="/assets/images/verovio-logo-big.png"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" /><!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="/assets/css/bootstrap/css/bootstrap.min.css" type="text/css" /><!-- Optional theme -->
        <link rel="stylesheet" href="/assets/css/bootstrap/css/bootstrap-theme.min.css" type="text/css" />
        <link rel="stylesheet" href="/assets/css/fileinput.min.css" />

        <!-- syntax highlighting CSS -->
        <link rel="stylesheet" href="/assets/css/syntax.css" />

        <!-- Custom CSS -->
        <link rel="stylesheet" href="/assets/css/verovio.css" />
        <link rel="stylesheet" href="/assets/css/midiplayer.css" />

        <link rel="stylesheet" href="/css/verovio-site.css" />

        <script src="/assets/javascript/jquery-3.6.0.min.js" type="text/javascript" ></script>
    </head>
    <body>

        <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
     <div class="container">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                </button>
            <a class="navbar-brand logo-nav" href="https://www.verovio.org/index.xhtml"><img src="/assets/images/verovio-fadded-50.png" /></a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav navbar-right">
                <li >
                    <a href="https://www.verovio.org/index.xhtml">Homepage</a>
                </li>
                <li class="active">
                    <a href="/index.html">Reference book</a>
                </li>
                <li >
                    <a href="https://www.verovio.org/test-suite.xhtml">Test suite</a>
                </li>
                <!--
                <li >
                    <a href="/tutorial.xhtml">Tutorial</a>
                </li>
                <li >
                    <a href="/mei-viewer.xhtml">MEI Viewer</a>
                </li>
                <li >
                    <a href="/app.html">Verovio App</a>
                </li>
                <li >
                    <a href="/musicxml.html">Other formats</a>
                </li>
                -->
                <!--
                <li class="dropdown ">
                    <a href="/" class="dropdown-toggle" data-toggle="dropdown">Plaine &amp; Easie<b class="caret"></b></a>
                    <ul class="dropdown-menu">
                          <li><a href="/pae-examples.xhtml">Examples</a></li>
                          <li><a href="/pae-editor.xhtml">Editor</a></li>
                    </ul>
                </li>
                -->
              </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>


        <div class="top-header"> 
    <div class="container" style="color: #eee; height: 140px; padding-top: 5px;">
        <h1 class="visible-print">Reference book for Verovio</h1>
        <h1 class="hidden-print hidden-xs">A music notation engraving library</h1> 
        <h3 class="hidden-print visible-xs">A music notation engraving library</h3> 
        <p class="hidden-print">Designed for the Music Encoding Initiative - Fast - Light - Flexible - No dependencies</p>
    </div>
</div>


        <div class="container with-footer">

            



<div class="row">
    <div class="col-md-3 sidebar-offcanvas" id="sidebar">
        <div class="toc-group">

    <a class="toc-item" href="/introduction/">Introduction</a>
    

    <a class="toc-item" href="/web-based-notation/">Tutorial 1: Web-based notation</a>
    

    <a class="toc-item" href="/interactive-notation/">Tutorial 2: Interactive notation</a>
    

    <a class="toc-item" href="/advanced-topics/">Beyond tutorials: Advanced topics</a>
    

    <a class="toc-item" href="/toolkit-reference/input-formats.html">Toolkit Reference</a>
    

    <a class="toc-item" href="/installing-or-building-from-sources/command-line.html">Installing or building from sources</a>
    

    <a class="toc-item" href="/contributing/">Contributing</a>
    
        
        
<a class="toc-item toc-section " href="/contributing/">Introduction</a>
    

<a class="toc-item toc-section selected" href="/contributing/guidelines.html">Coding guidelines</a>
    
        
        
<a class="toc-item toc-subsection" href="#formatting">Formatting</a>

<a class="toc-item toc-subsection" href="#includes-and-forward-declarations">Includes and forward declarations</a>

<a class="toc-item toc-subsection" href="#null-and-boolean">Null and boolean</a>

<a class="toc-item toc-subsection" href="#class-method-and-member-names">Class, method and member names</a>

<a class="toc-item toc-subsection" href="#comments">Comments</a>

<a class="toc-item toc-subsection" href="#libmei">LibMEI</a>

    

<a class="toc-item toc-section " href="/contributing/workflow.html">Contributing workflow</a>
    

<a class="toc-item toc-section " href="/contributing/generate-code-with-libmei.html">Generate code with libMEI</a>
    

<a class="toc-item toc-section " href="/contributing/adding-smufl-glyphs.html">Adding SMuFL glyphs</a>
    

    

</div>
    </div>

    <div class="col-md-9">
        <div class="panel">
            <a class="hidden-print" href="https://github.com/rism-digital/verovio-reference-book/edit/master/_book/07-contributing/01-guidelines.md"><button class="btn btn-xs pull-right">Edit this page</button></a>
            <h2>Coding guidelines</h2>
            <p>This document describes the coding style for the Verovio project for the C++ part of the codebase.</p>

<h3 id="formatting">Formatting</h3>

<p>Verovio uses a <a href="http://clang.llvm.org/docs/ClangFormat.html">Clang-Format</a> (<strong>5.0</strong>) coding style based on the <a href="https://webkit.org/code-style-guidelines/">WebKit</a> style, with a few minor modifications. The modifications include:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AllowShortIfStatementsOnASingleLine: true
AllowShortLoopsOnASingleLine: true
ColumnLimit: 120
ConstructorInitializerAllOnOneLineOrOnePerLine: true
PointerAlignment: Right
</code></pre></div></div>

<p>The simplest way to fullfil the Verovio coding style is to use a clang-format tool and to apply the style defined in the 
<a href="../.clang-format">.clang-format</a> file available in the project root directory.</p>

<h4 id="downloading-clang-format-for-os-x">Downloading clang-format for OS X</h4>

<p>An easy way to install clang-format on OS X computers is to use <a href="http://brew.sh">Hombrew</a>.  Type this command in the terminal to install:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew <span class="nb">install </span>clang-format
</code></pre></div></div>

<h4 id="running-clang-format">Running clang-format</h4>

<p><em>Please make sure you use version 5.0</em></p>

<p>To use clang-format to adjust a single file:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>clang-format <span class="nt">-style</span><span class="o">=</span>file <span class="nt">-i</span>   some-directory/some-file.cpp
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">-style=file</code> option instructs clang-format to search for the .clang-format configuration file (recursively in some parent directory).  The <code class="language-plaintext highlighter-rouge">-i</code> option is used to alter the file “in-place”.  If you don’t give the <code class="language-plaintext highlighter-rouge">-i</code> option, a fomatted copy of the file will be sent to standard output.</p>

<h3 id="includes-and-forward-declarations">Includes and forward declarations</h3>

<p>Includes in the header files must list first the system includes followed by the Verovio includes, if any, and then the includes for the libraries included in Verovio. All includes have to be ordered alphabetically:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include &lt;string&gt;
#include &lt;utility&gt;
#include &lt;vector&gt;
</span>
<span class="c1">//----------------------------------------------------------------------------</span>

<span class="cp">#include "attclasses.h"
#include "atttypes.h"
</span>
<span class="c1">//----------------------------------------------------------------------------  </span>

<span class="cp">#include "pugixml.hpp"
#include "utf8.h"
</span></code></pre></div></div>

<p>In the header files, always use forward declarations (and not includes) whenever possible. Forward declaration have to be ordered alphabetically:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">DeviceContext</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Layer</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">StaffAlignment</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">Syl</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">TimeSpanningInterface</span><span class="p">;</span>
</code></pre></div></div>

<p>In the implementation files, the first include in always the include of the corresponding header file, followed by the system includes and then the other Verovio includes with libraries at the end too, if any, also ordered alphabetically:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">#include "att.h"
</span>
<span class="c1">//----------------------------------------------------------------------------</span>

<span class="cp">#include &lt;sstream&gt;
#include &lt;stdlib.h&gt;
</span>
<span class="c1">//----------------------------------------------------------------------------</span>

<span class="cp">#include "object.h"
#include "vrv.h"
</span>
<span class="c1">//----------------------------------------------------------------------------  </span>

<span class="cp">#include "pugixml.hpp"
</span></code></pre></div></div>

<h3 id="null-and-boolean">Null and boolean</h3>

<p>The null pointer value should be written as <code class="language-plaintext highlighter-rouge">NULL</code>. Boolean values should be written as <code class="language-plaintext highlighter-rouge">true</code> and <code class="language-plaintext highlighter-rouge">false</code>.</p>

<h3 id="class-method-and-member-names">Class, method and member names</h3>

<p>All class names must be in upper CamelCase. The internal capitalization follows the MEI one:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Measure</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">ScoreDef</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">StaffDef</span><span class="p">;</span>
</code></pre></div></div>

<p>All method names must also be in upper CamelCase:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">Measure</span><span class="o">::</span><span class="n">AddStaff</span><span class="p">(</span><span class="n">Staff</span> <span class="o">*</span><span class="n">staff</span><span class="p">)</span> <span class="p">{}</span>
</code></pre></div></div>

<p>All member names must be in lower camelCase. Instance members must be prefixed with <code class="language-plaintext highlighter-rouge">m_</code> and class (static) members with <code class="language-plaintext highlighter-rouge">s_</code>:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Glyph</span> <span class="p">{</span>
<span class="nl">public:</span>

    <span class="cm">/** An instance member */</span>
    <span class="kt">int</span> <span class="n">m_unitsPerEm</span><span class="p">;</span>
    
    <span class="cm">/** A static member */</span>
    <span class="k">static</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">s_systemPath</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div></div>

<p>In the class declaration, the methods are declared first, and then the member variables. For both, the declaration order is <code class="language-plaintext highlighter-rouge">public</code>, <code class="language-plaintext highlighter-rouge">protected</code>, and <code class="language-plaintext highlighter-rouge">private</code>.</p>

<h3 id="comments">Comments</h3>

<p>Comments for describing methods can be grouped using <code class="language-plaintext highlighter-rouge">///@{</code> and <code class="language-plaintext highlighter-rouge">///@}</code> delimiters together with the <code class="language-plaintext highlighter-rouge">@name</code> indication:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @name Add children to an editorial element.
 */</span>
<span class="c1">///@{</span>
<span class="kt">void</span> <span class="nf">AddFloatingElement</span><span class="p">(</span><span class="n">FloatingElement</span> <span class="o">*</span><span class="n">child</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">AddLayerElement</span><span class="p">(</span><span class="n">LayerElement</span> <span class="o">*</span><span class="n">child</span><span class="p">);</span>
<span class="kt">void</span> <span class="nf">AddTextElement</span><span class="p">(</span><span class="n">TextElement</span> <span class="o">*</span><span class="n">child</span><span class="p">);</span>
<span class="c1">///@}</span>
</code></pre></div></div>

<h3 id="libmei">LibMEI</h3>

<p>The code for the attribute classes of Verovio are generated from the MEI schema using a modified version of LibMEI available <a href="https://github.com/rism-digital/libmei">here</a>. The code generated is included in the Verovio repository in ./libmei and the LibMEI repository does not need to be cloned for building Verovio.</p>

<p>The attribute classes generated from the MEI schema provide all the members for the element classes of Verovio. They are implemented via multiple inheritance in element classes. The element classes corresponding to the MEI elements are not generated by LibMEI but are implemented explicitly in Verovio. They all inherit from the <code class="language-plaintext highlighter-rouge">Object</code> class (of the <code class="language-plaintext highlighter-rouge">vrv</code> namespace) or from a <code class="language-plaintext highlighter-rouge">Object</code> child class. They can inherit from various interfaces used for the rendering. All the MEI member are defined through the inheritance of generated attribute classes, either grouped as interfaces or individually.</p>

<p>For example, the MEI &lt;note&gt; is implemented as a <code class="language-plaintext highlighter-rouge">Note</code> class that inherit from <code class="language-plaintext highlighter-rouge">Object</code> through <code class="language-plaintext highlighter-rouge">LayerElement</code>. It also inherit from the StemmedDrawingInterface that holds data used for the rendering.</p>

<p>Its MEI members are defined through the <code class="language-plaintext highlighter-rouge">DurationInterface</code> and <code class="language-plaintext highlighter-rouge">PitchInterface</code> that regroup common functionnalities for durational and pitched MEI elements respectively plus some additional individual attribute classes.</p>

<p>The inheritance should always list <code class="language-plaintext highlighter-rouge">Object</code> (or the <code class="language-plaintext highlighter-rouge">Object</code> child class) first, followed by the rendering interfaces, followed by the attribute class interfaces, followed by the individual attribute classes, each of them ordered alphabetically:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Note</span> <span class="o">:</span> <span class="k">public</span> <span class="n">LayerElement</span><span class="p">,</span>
                <span class="k">public</span> <span class="n">StemmedDrawingInterface</span><span class="p">,</span>
                <span class="k">public</span> <span class="n">DurationInterface</span><span class="p">,</span>
                <span class="k">public</span> <span class="n">PitchInterface</span><span class="p">,</span>
                <span class="k">public</span> <span class="n">AttColoration</span><span class="p">,</span>
                <span class="k">public</span> <span class="n">AttGraced</span><span class="p">,</span>
                <span class="k">public</span> <span class="n">AttStems</span><span class="p">,</span>
                <span class="k">public</span> <span class="n">AttTiepresent</span>
</code></pre></div></div>

<p>In the implementation, the same order must be followed, for the constructor calls and for the registration of the interfaces and individual attribute classes:</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">Note</span><span class="o">::</span><span class="n">Note</span><span class="p">()</span>
    <span class="o">:</span> <span class="n">LayerElement</span><span class="p">(</span><span class="s">"note-"</span><span class="p">)</span>
    <span class="p">,</span> <span class="n">StemmedDrawingInterface</span><span class="p">()</span>
    <span class="p">,</span> <span class="n">DurationInterface</span><span class="p">()</span>
    <span class="p">,</span> <span class="n">PitchInterface</span><span class="p">()</span>
    <span class="p">,</span> <span class="n">AttColoration</span><span class="p">()</span>
    <span class="p">,</span> <span class="n">AttGraced</span><span class="p">()</span>
    <span class="p">,</span> <span class="n">AttStems</span><span class="p">()</span>
    <span class="p">,</span> <span class="n">AttTiepresent</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">RegisterInterface</span><span class="p">(</span><span class="n">DurationInterface</span><span class="o">::</span><span class="n">GetAttClasses</span><span class="p">(),</span> <span class="n">DurationInterface</span><span class="o">::</span><span class="n">IsInterface</span><span class="p">());</span>
    <span class="n">RegisterInterface</span><span class="p">(</span><span class="n">PitchInterface</span><span class="o">::</span><span class="n">GetAttClasses</span><span class="p">(),</span> <span class="n">PitchInterface</span><span class="o">::</span><span class="n">IsInterface</span><span class="p">());</span>
    <span class="n">RegisterAttClass</span><span class="p">(</span><span class="n">ATT_COLORATION</span><span class="p">);</span>
    <span class="n">RegisterAttClass</span><span class="p">(</span><span class="n">ATT_GRACED</span><span class="p">);</span>
    <span class="n">RegisterAttClass</span><span class="p">(</span><span class="n">ATT_STEMS</span><span class="p">);</span>
    <span class="n">RegisterAttClass</span><span class="p">(</span><span class="n">ATT_TIEPRESENT</span><span class="p">);</span>

    <span class="n">Reset</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Resetting the attributes is required and follows the same order</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">Note</span><span class="o">::</span><span class="n">Reset</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">LayerElement</span><span class="o">::</span><span class="n">Reset</span><span class="p">();</span>
    <span class="n">StemmedDrawingInterface</span><span class="o">::</span><span class="n">Reset</span><span class="p">();</span>
    <span class="n">DurationInterface</span><span class="o">::</span><span class="n">Reset</span><span class="p">();</span>
    <span class="n">PitchInterface</span><span class="o">::</span><span class="n">Reset</span><span class="p">();</span>
    <span class="n">ResetColoration</span><span class="p">();</span>
    <span class="n">ResetGraced</span><span class="p">();</span>
    <span class="n">ResetStems</span><span class="p">();</span>
    <span class="n">ResetTiepresent</span><span class="p">();</span>
    
    <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

        </div>
    </div>
</div>

<script>
    let options = {
        rootMargin: '60px'
    }
    window.addEventListener('DOMContentLoaded', () => {
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                const id = entry.target.getAttribute('id');
                if (entry.intersectionRatio > 0) {
                    // First deselect everything
                    sections = document.querySelectorAll(`.toc-group a.toc-subsection`);
                    for (i = 0; i < sections.length; i++){
                        sections[i].classList.remove('selected');
                    }
                    // The one entering is marked as .on-screen
                    document.querySelector(`.toc-group a[href="#${id}"]`).classList.add('on-screen');
                    // Select the first that in .on-screen
                    sections = document.querySelectorAll(`.toc-group a.toc-subsection.on-screen`);
                    sections[0].classList.add('selected');

                } else {
                    leaving = document.querySelector(`.toc-group a[href="#${id}"]`)
                    // Remove the .on-screen from the one leaving
                    leaving.classList.remove('on-screen');
                    sections = document.querySelectorAll(`.toc-group a.toc-subsection.on-screen`);
                    // If no other one is on screen, just leave things as they are
                    if (sections.length > 0) {
                        // Otherwise de-select the one that is leaving
                        leaving.classList.remove('selected');
                        // Selected the first .on-screen one and de-select the other ones
                        sections[0].classList.add('selected');
                        for (i = 1; i < sections.length; i++){
                            console.log(sections[i].getAttribute('id'))
                            sections[i].classList.remove('selected');
                        }
                    }
                }
            });
        }, options);

        // Track all sections that have an `id` applied
        document.querySelectorAll('h3[id]').forEach((section) => {
            observer.observe(section);
        });

        });
</script>



        </div>

        <footer class="footer navbar-fixed-bottom">
            <p>
                
            </p>
        </footer>

        <script type="text/javascript">
        //<![CDATA[
            $(document).ready(function() {

                

            });
        //]]>
        </script>
    </body>
</html>
